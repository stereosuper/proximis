{"version":3,"sources":["webpack:///./wp-content/themes/proximis/src/js/components/referencesSlider.js"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAgE;AACb;AACF;;AAEjD;AACA,uBAAuB,2DAAc;;AAErC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,QAAQ,6DAAa;AACrB;AACA;AACA;AACA,uDAAuD,OAAO;;AAE9D;AACA;AACA;AACA;AACA,uDAAuD;AACvD;AACA,SAAS;AACT;AACA;AACA,aAAa;AACb,oBAAoB,MAAM;AAC1B;AACA;AACA,aAAa;AACb;AACA,4BAA4B,YAAY;AACxC;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB,6DAAK;AAC7B,oCAAoC,oBAAoB;AACxD,SAAS;;AAET;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,uDAAuD,OAAO;;AAE9D;AACA;AACA;AACA;AACA,uDAAuD;AACvD,aAAa;AACb,sCAAsC,oBAAoB;AAC1D,SAAS;AACT;AACA;AACA;;AAEA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,iCAAiC,6DAAK;AACtC;AACA;AACA,SAAS;;AAET,2BAA2B,6DAAK;AAChC;AACA;AACA,SAAS;;AAET;;AAEA,QAAQ,6CAAQ;AAChB;AACA,SAAS;;AAET,QAAQ,6CAAQ;AAChB;AACA,SAAS;;AAET,QAAQ,6CAAQ;AAChB;AACA;AACA,gBAAgB,6CAAQ;AACxB;AACA;AACA,iBAAiB;AACjB;AACA,SAAS;AACT;AACA;AACA,2BAA2B,6DAAK;AAChC,aAAa,oCAAoC;AACjD;AACA;AACA,iCAAiC,6DAAK;AACtC,aAAa,sCAAsC;AACnD;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,8BAA8B,6DAAK,EAAE,oCAAoC;AACzE;;AAEA,yCAAyC,6DAAK;AAC9C;AACA;AACA,SAAS;;AAET,eAAe,SAAS;AACxB,QAAQ,6CAAQ,gCAAgC,YAAY,OAAO,KAAK;;AAExE;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA,4BAA4B,6DAAK,EAAE,6BAA6B;;AAEhE,QAAQ,+DAAO;AACf;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,oBAAoB,8CAAS;AAC7B;AACA;AACA,yBAAyB;AACzB,8BAA8B,2CAAM;AACpC,qBAAqB;;AAErB,iDAAiD,iBAAiB;AAClE;AACA,iBAAiB;AACjB;AACA;AACA,SAAS;AACT;AACA;AACA,iCAAiC,6DAAK,EAAE,6BAA6B;AACrE;;AAEA;AACA;AACA;AACA,SAAS;AACT;AACA;;AAEe,+EAAgB,EAAC","file":"referencesSlider.js","sourcesContent":["import { superPolyfill, query, forEach } from '@stereorepo/sac';\nimport { TweenMax, Power2, TweenLite } from 'gsap';\nimport ScrollToPlugin from 'gsap/ScrollToPlugin';\n\n// NOTE: We need to use ScrollToPlugin in order to ensure that the plugin won't be tree-shaked\nconst ensureScrollTo = ScrollToPlugin;\n\nclass ReferencesSlider {\n    constructor() {\n        this.referenceSlider = null;\n        this.idsList = [];\n        this.currentReferenceId = 0;\n        this.newReferenceId = 0;\n        this.type = null;\n        this.currentSlide = null;\n\n        superPolyfill.initializeWhatwgFetch();\n    }\n    getAllSlideIds(callback) {\n        const action = 'get_references_ids';\n        const url = `/wp-admin/admin-ajax.php?action=${action}`;\n\n        fetch(url, {\n            method: 'GET',\n            headers: {\n                'Content-Type':\n                    'application/x-www-form-urlencoded; charset=utf-8'\n            }\n        })\n            .then(res => {\n                return res.json();\n            })\n            .then(({ ids }) => {\n                this.idsList = [...ids];\n                callback();\n            });\n    }\n    selectFollowingElement({ id = null }) {\n        if (id !== null) {\n            this.newReferenceId = id;\n        } else {\n            this.findFollowingElement();\n        }\n    }\n    findFollowingElement() {\n        const idIndex = this.idsList.indexOf(this.currentReferenceId);\n\n        if (this.type === 'next') {\n            this.newReferenceId =\n                idIndex + 2 > this.idsList.length\n                    ? this.idsList.slice(0, 1)\n                    : this.idsList.slice(idIndex + 1, idIndex + 2);\n        } else if (this.type === 'prev') {\n            this.newReferenceId =\n                idIndex - 1 < 0\n                    ? this.idsList.slice(-1)\n                    : this.idsList.slice(idIndex - 1, idIndex - 2);\n        }\n    }\n    checkLoadingCall() {\n        if (this.newReferenceId === this.currentReferenceId) return;\n        const [slide] = query({\n            selector: `.js-ref-id-${this.newReferenceId}`\n        });\n\n        if (slide) {\n            slide.classList.add('js-ref-following-slide');\n            this.slideAnimation();\n        } else {\n            this.startLoadingAction();\n        }\n    }\n    startLoadingAction() {\n        const action = 'load_references';\n        const url = `/wp-admin/admin-ajax.php?action=${action}`;\n\n        fetch(url, {\n            method: 'POST',\n            headers: {\n                'Content-Type':\n                    'application/x-www-form-urlencoded; charset=utf-8'\n            },\n            body: `new_reference_id=${this.newReferenceId}`\n        })\n            .then(res => res.text())\n            .then(response => {\n                this.currentSlide.insertAdjacentHTML('afterend', response);\n\n                this.slideAnimation();\n            });\n    }\n    slideAnimation() {\n        let selector = '.js-ref-following-slide';\n        let xPercent = 0;\n        switch (this.type) {\n            case 'prev':\n                xPercent = -100;\n                break;\n            case 'next':\n                xPercent = 100;\n                break;\n            default:\n                xPercent = 100;\n                break;\n        }\n\n        const [followingSlide] = query({\n            selector,\n            ctx: this.referenceSlider\n        });\n\n        const [oldSlide] = query({\n            selector: '.js-ref-current-slide',\n            ctx: this.referenceSlider\n        });\n\n        oldSlide.classList.remove('ref-slide-init');\n\n        TweenMax.set(followingSlide, {\n            xPercent\n        });\n\n        TweenMax.set(followingSlide, {\n            xPercent\n        });\n\n        TweenMax.to(oldSlide, 0.3, {\n            xPercent: -xPercent,\n            onComplete: () => {\n                TweenMax.to(followingSlide, 0.3, {\n                    xPercent: 0,\n                    onComplete: this.resetContext()\n                });\n            }\n        });\n    }\n    resetContext() {\n        const [oldSlide] = query(\n            { selector: '.js-ref-current-slide' },\n            this.referenceSlider\n        );\n        const [followingSlide] = query(\n            { selector: '.js-ref-following-slide' },\n            this.referenceSlider\n        );\n\n        oldSlide.classList.remove('js-ref-current-slide');\n\n        followingSlide.classList.remove('js-ref-following-slide');\n        followingSlide.classList.add('js-ref-current-slide');\n\n        this.currentReferenceId = 0;\n        this.newReferenceId = 0;\n        this.type = null;\n        this.currentSlide = null;\n\n        this.setCurrentContext();\n    }\n    setCurrentContext() {\n        if (this.idsList.length < 2) return;\n\n        [this.currentSlide] = query({ selector: '.js-ref-current-slide' });\n        this.currentReferenceId = parseInt(this.currentSlide.dataset.refId, 10);\n\n        const [prevButton, nextButton] = query({\n            selector: '.js-button-hexagon',\n            ctx: this.currentSlide\n        });\n\n        const { height } = this.currentSlide.getBoundingClientRect();\n        TweenMax.to(this.referenceSlider, 0.3, { height: `${height}px` });\n\n        prevButton.addEventListener(\n            'click',\n            () => {\n                this.type = 'prev';\n                this.findFollowingElement();\n                this.checkLoadingCall();\n            },\n            false\n        );\n        nextButton.addEventListener(\n            'click',\n            () => {\n                this.type = 'next';\n                this.findFollowingElement();\n                this.checkLoadingCall();\n            },\n            false\n        );\n    }\n    initializeCaseStudyClickEvent() {\n        const caseStudies = query({ selector: '.js-case-study' });\n\n        forEach(caseStudies, caseStudy => {\n            caseStudy.addEventListener(\n                'click',\n                event => {\n                    event.preventDefault();\n                    const selectedId = parseInt(caseStudy.dataset.refId, 10);\n\n                    const offset =\n                        window.scrollY +\n                        this.referenceSlider.getBoundingClientRect().top;\n\n                    TweenLite.to(window, 0.5, {\n                        scrollTo: {\n                            y: offset\n                        },\n                        ease: Power2.easeInOut\n                    });\n\n                    this.selectFollowingElement({ id: selectedId });\n                    this.checkLoadingCall();\n                },\n                false\n            );\n        });\n    }\n    initialize() {\n        [this.referenceSlider] = query({ selector: '.js-ref-slider' });\n        if (!this.referenceSlider) return;\n\n        this.getAllSlideIds(() => {\n            this.initializeCaseStudyClickEvent();\n            this.setCurrentContext();\n        });\n    }\n}\n\nexport default ReferencesSlider;\n"],"sourceRoot":""}